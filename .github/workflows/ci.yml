name: pylavi-checks

on:
  push:
    branches:
      - main
      - master
    paths:
      - 'source'
  pull_request:
  workflow_dispatch:

jobs:

  Checks:
  
    runs-on: ubuntu-latest

    env:
      LABVIEW_VERSION_NUMBER: '20.1'
      LABVIEW_VERSION_YEAR: '2020'
      LABVIEW_BITNESS: '64'

    steps:

      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Install pylavi
        run: |
          pip install pylavi

      - name: Run pylavi Tests
        run: |
          echo running pylavi tests
          vi_validate \
            --path source \ # add `source` dir to checks
            --path tests \  # add `tests` dir to checks
            --skip *.vit \  # skip vit files (since pylavi will show these as containing source)
            --no-code \     # `Separate Compiled Code` required for all VIs
            --breakpoints \ # `No Breakpoints` allowed in code
          echo finished pylavi tests
